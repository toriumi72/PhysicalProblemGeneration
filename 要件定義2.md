# 要件定義2

この文書は、物理問題生成ダッシュボードアプリにおける基本機能およびProプラン向けの高度なLLS機能を含む、全体の要件定義をまとめたものです。

---

## 1. アプリケーション概要

- **目的**  
  ユーザが選択した物理の単元に基づき、LLM/LLS を活用して問題文、回答、ヒント、解説などを自動生成するとともに、学習履歴や評価結果を保存し、後日参照できる環境を提供します。

- **主な機能**  
  - **問題生成機能**: 単元選択に基づいた自動問題生成。  
  - **問題管理機能**: 生成された問題の一覧、詳細ビュー、削除等。  
  - **ユーザ管理機能**: サインアップ、サインイン、プロフィール設定、パスワード変更など。  
  - **ダッシュボード表示**: 学習状況、利用統計、問題生成履歴の可視化。

---

## 2. 基本機能（無料プランおよび基本サービス）

### 2.1 問題生成機能
- 単元情報をもとに外部API（Dify等）を介して問題文、回答、ヒントを自動生成する。
- 生成リクエストの送信、レスポンス整形、データベースへの保存処理を実装。

### 2.2 問題管理機能
- 生成済みの問題一覧、詳細表示、削除機能の提供。
- ユーザ評価の記録や、生成履歴のエクスポート（CSV, JSON）機能の将来的な実装。

### 2.3 ユーザ管理・設定機能
- サインアップ／サインイン、ログアウト、パスワード変更などの基本認証機能。
- ユーザごとに問題生成履歴や評価結果を保存し、後日参照可能にする仕組みの実装。

### 2.4 ダッシュボード表示機能
- ユーザの学習状況（問題数、正解率、利用状況など）をグラフおよび数値で表示。
- 利用履歴のエクスポート機能も含む統計情報の提供。

---

## 3. Proプラン向け高度なLLS機能と拡張機能

Proプランでは、無料プランと明確に差別化し、より高品質で柔軟な問題生成、および運用環境を実現します。主な拡張機能は以下の通りです。

### 3.1 高度な生成パラメータ設定

- **概要**  
  問題生成時に、単元情報に加え、難易度、問題形式、解説・ヒントの詳細度など高度なパラメータの設定を可能にする。

- **UI要件**  
  - 「詳細設定」パネルの実装。  
  - 設定項目例:  
    - **難易度**: 初級、中級、上級、および微調整用スライダー。  
    - **問題形式**: 選択式、記述式、数式を含む形式。  
    - **解説詳細度**: シンプル～詳細なステップ解説。  
    - **ヒント数**: 1～5問までの設定。

- **バックエンド要件**  
  - 各設定項目をAPIリクエストに含め、LLSまたは外部APIへ適切にマッピング。  
  - 値のバリデーション、無効値チェック、設定ログの管理。

### 3.2 マルチパラレル生成機能

- **概要**  
  一度のリクエストで複数の問題（例：5問、10問）の同時生成を可能にし、学習効率を向上させる。

- **UI要件**  
  - 問題生成画面に生成問題数を選択するUI（ドロップダウン・数値入力）を追加。  
  - 各問題の生成進捗（待機中、生成中、完了）をリアルタイムで表示。

- **バックエンド要件**  
  - 非同期処理・並列化の仕組みの導入（例：キュー管理システム、非同期API処理）。  
  - 個別の生成リクエストに固有のID付与と進捗管理。  
  - 負荷分散、リトライ、タイムアウト等の処理強化。

### 3.3 高品質な問題文・解説生成

- **概要**  
  Proプラン専用のLLSエンドポイントまたはカスタムLLSモデルを利用し、より高精度な問題生成を行う。

- **実装要件**  
  - Pro専用のAPIキー、専用エンドポイントおよびパラメータセットの導入。  
  - 生成結果のクオリティフィードバック（例：専門家評価やユーザ評価）の収集と分析。

### 3.4 カスタムプロンプトエンジン

- **概要**  
  ユーザが独自のプロンプトテンプレートを作成、保存、再利用できる仕組みを提供し、学習スタイルに応じた問題生成を可能にする。

- **UI要件**  
  - リッチテキストエディタ形式のプロンプトエディタ画面の実装。  
  - 作成済みプロンプトの管理および再利用機能の提供。

- **バックエンド要件**  
  - ユーザプロフィールに紐付けたカスタムプロンプトの保存用テーブルの設計。  
  - 選択されたプロンプトテンプレートを問題生成APIリクエストに反映。

### 3.5 優先キューとAPIレート制限の拡張

- **概要**  
  プロプランユーザのAPIリクエストについて、優先順位を高く設定し、レート制限の緩和を実施する。

- **バックエンド要件**  
  - ユーザプランに応じたリクエスト優先度の制御。  
  - 優先処理用の専用キュー（例：RabbitMQ、AWS SQS等）の導入。  
  - リトライ処理、タイムアウト、エラーハンドリングの強化。

### 3.6 統計情報と利用制限の詳細表示

- **概要**  
  Proプランユーザに対して、生成履歴、利用回数、平均生成時間など、詳細な統計情報を提供する。

- **UI要件**  
  - 専用ダッシュボードにて、各種利用指標をグラフと数値で表示。  
  - 利用制限が近づいた場合の警告表示や追加購入オプションの提供。

- **バックエンド要件**  
  - ログの集計処理、定期バッチまたはリアルタイム更新で統計情報APIを提供。

### 3.7 バックエンドアーキテクチャの強化

- **概要**  
  高負荷時にも安定動作するため、クラウドによる自動スケーリング、冗長化、また分散処理体制を構築する。

- **インフラ要件**  
  - オートスケーリング（Kubernetes、AWS Auto Scaling等）の導入。  
  - ログ収集、監視ツール（Datadog、Prometheus等）との統合。  
  - 非同期処理、タイムアウト、リトライ処理の堅牢な実装。

### 3.8 料金プラン連動のUI変更と差別化

- **概要**  
  Proプラン専用のUIテーマおよびレイアウトで、無料プランとの差別化を図る。

- **UI要件**  
  - Proプラン専用セクション（例：「プレミアム設定」、「詳細統計情報」）の実装。  
  - 明確なデザイン・配色の分離。

- **バックエンド要件**  
  - ユーザのプラン情報に基づき、適切なレスポンスやコンテンツを選択して提供する仕組み。

### 3.9 セキュリティおよびコンプライアンス強化

- **概要**  
  機密性の高い情報（カスタムプロンプト、生成データなど）の取り扱いにおいて、厳格なセキュリティ対策を実施する。

- **実装要件**  
  - 全通信のHTTPS/TLS化とデータ暗号化。  
  - 多要素認証、トークン管理、セッション管理の強化。  
  - セキュリティ監査ログの保持と脆弱性スキャンツールの導入。

### 3.10 Pro専用サポートとフィードバック連携

- **概要**  
  プロプラン利用者向けに専用のサポートチャネルとフィードバック機能を提供し、トラブルや改善要望に迅速に対応する。

- **UI要件**  
  - サポート問い合わせフォーム、FAQ、ライブチャット、フィードバックボタンの設置。

- **バックエンド要件**  
  - フィードバック情報の収集・集計、サポートチーム向けの管理コンソールの実装。

---

## 4. まとめ

本要件定義では、以下を実現することを目的としています。

- **ユーザ最適化**  
  高度な生成パラメータ設定やカスタムプロンプト機能により、ユーザごとの学習ニーズに合わせた最適な問題生成を実現。

- **効率向上**  
  マルチパラレル生成や優先キューの仕組みにより、迅速な問題生成と負荷分散処理を達成。

- **高品質生成**  
  専用のLLSエンドポイントを用いて、質の高い問題文、解説、ヒントの生成を実現し、生成品質のフィードバックループを形成。

- **運用・セキュリティ**  
  バックエンドのスケーラビリティ、セキュリティ強化、監視体制の整備により、安定した運用環境を提供。

- **差別化**  
  Proプラン専用のUI・サポート体制により、無料プランとの明確な差別化と、ユーザの学習成果・運用メリットの向上を図る。

以上の拡張機能および技術的向上により、プロプランユーザは高品質な問題生成サービスと柔軟なカスタマイズ機能を享受でき、学習効率と運用体験が大幅に向上することが期待されます。 